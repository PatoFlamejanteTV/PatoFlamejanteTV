name: Generate Repos MD

on:
  schedule:
    - cron: '0 0 * * *'  # Runs daily at midnight
  push: {branches: ["main"]}

jobs:
  update-repos-md:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Fetch recent public repos
      run: |
        curl -s https://api.github.com/users/PatoFlamejanteTV/repos?type=public&sort=updated&per_page=5 > repos.json
        node -e '
        const fs = require("fs");
        const repos = JSON.parse(fs.readFileSync("repos.json", "utf-8"));
        const content = repos.map(repo => `## ${repo.name}\n\n${repo.description || "No description provided."}\n`).join("\n");
        fs.writeFileSync("repos.md", content);
        '

    - name: Commit and push changes
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'
        git add repos.md
        git commit -m 'Update repos.md'
        git push
